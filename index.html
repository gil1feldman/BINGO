<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>דשבורד פעילות פרלמנטרית - גרסה מתוקנת</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&display=swap');
        body { font-family: 'Assistant', sans-serif; background-color: #f3f4f6; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="root">
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; flex-direction: column;">
            <div style="font-size: 24px; color: #4B5563;">טוען את המערכת...</div>
            <div style="font-size: 14px; color: #9CA3AF; margin-top: 10px;">(אם הודעה זו נשארת, יש שגיאה בקונסול)</div>
        </div>
    </div>

    <div id="error-display" style="display:none; padding: 20px; background: #fee2e2; color: #b91c1c; position: fixed; top: 0; left: 0; right: 0; z-index: 9999;"></div>

    <script>
        // תופס שגיאות גלובליות ומציג אותן למשתמש
        window.onerror = function(message, source, lineno, colno, error) {
            const errorDiv = document.getElementById('error-display');
            errorDiv.style.display = 'block';
            errorDiv.innerHTML = `<strong>שגיאה בטעינת הדף:</strong><br>${message}<br><small>Line: ${lineno}</small>`;
        };
    </script>

    <script type="text/babel">
        try {
            const { useState, useEffect } = React;
            
            // בדיקה ש-Recharts נטען
            if (!window.Recharts) {
                throw new Error("ספריית Recharts לא נטענה כראוי. בדוק את החיבור לאינטרנט.");
            }

            const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = window.Recharts;

            // --- אייקונים ---
            const Icons = {
                Bill: () => <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>,
                Vote: () => <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>,
                Query: () => <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>,
                Motion: () => <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>,
                User: () => <svg className="w-12 h-12 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            };

            // --- נתונים ---
            const MK_LIST = [
                { id: 1, name: "דוד ביטן", party: "הליכוד" },
                { id: 2, name: "יאיר לפיד", party: "יש עתיד" },
                { id: 3, name: "בני גנץ", party: "המחנה הממלכתי" },
                { id: 4, name: "אריה דרעי", party: "ש\"ס" }
            ];

            const generateMKData = (mkId) => {
                const mk = MK_LIST.find(m => m.id === parseInt(mkId));
                return {
                    ...mk,
                    stats: { bills: 145, votes: 320, queries: 12, motions: 8 },
                    trendData: [
                        { name: 'יולי', bills: 4, votes: 40 },
                        { name: 'אוג', bills: 2, votes: 20 },
                        { name: 'ספט', bills: 6, votes: 55 },
                        { name: 'אוק', bills: 3, votes: 30 },
                        { name: 'נוב', bills: 8, votes: 65 },
                        { name: 'דצמ', bills: 5, votes: 45 }
                    ],
                    activities: [
                        { type: 'bill', title: 'הצעת חוק לתיקון פקודת התעבורה', date: '25/12/2023' },
                        { type: 'vote', title: 'הצבעה על תקציב המדינה 2024', date: '20/12/2023' },
                        { type: 'query', title: 'שאילתה בנושא מחסור ברופאים', date: '15/12/2023' }
                    ]
                };
            };

            // --- קומפוננטות ---
            const StatCard = ({ title, value, icon: Icon, color }) => (
                <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between">
                    <div>
                        <p className="text-gray-500 text-sm mb-1">{title}</p>
                        <p className="text-2xl font-bold text-gray-800">{value}</p>
                    </div>
                    <div className={`p-3 rounded-lg ${color}`}><Icon /></div>
                </div>
            );

            // --- אפליקציה ראשית ---
            const App = () => {
                const [selectedId, setSelectedId] = useState(1);
                const [data, setData] = useState(generateMKData(1));

                useEffect(() => {
                    setData(generateMKData(selectedId));
                }, [selectedId]);

                return (
                    <div className="min-h-screen pb-10">
                        {/* Header */}
                        <header className="bg-white border-b shadow-sm sticky top-0 z-10">
                            <div className="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
                                <h1 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                                    <span className="bg-blue-600 text-white p-1 rounded">KN</span> כנסת דאטה
                                </h1>
                                <select 
                                    className="border border-gray-300 rounded-md py-1 px-3 text-sm bg-gray-50"
                                    value={selectedId}
                                    onChange={(e) => setSelectedId(e.target.value)}
                                >
                                    {MK_LIST.map(mk => <option key={mk.id} value={mk.id}>{mk.name}</option>)}
                                </select>
                            </div>
                        </header>

                        <main className="max-w-6xl mx-auto px-4 py-8 space-y-6">
                            
                            {/* כותרת אישית */}
                            <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center gap-4">
                                <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center border-2 border-blue-100">
                                    <Icons.User />
                                </div>
                                <div>
                                    <h2 className="text-2xl font-bold">{data.name}</h2>
                                    <p className="text-gray-600">{data.party}</p>
                                </div>
                            </div>

                            {/* כרטיסי מידע */}
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <StatCard title="חקיקה" value={data.stats.bills} icon={Icons.Bill} color="bg-blue-50 text-blue-600" />
                                <StatCard title="הצבעות" value={data.stats.votes} icon={Icons.Vote} color="bg-green-50 text-green-600" />
                                <StatCard title="שאילתות" value={data.stats.queries} icon={Icons.Query} color="bg-purple-50 text-purple-600" />
                                <StatCard title="הצעות לסדר" value={data.stats.motions} icon={Icons.Motion} color="bg-orange-50 text-orange-600" />
                            </div>

                            {/* גרף ורשימה */}
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                {/* גרף */}
                                <div className="lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                                    <h3 className="font-bold mb-4">מגמות פעילות</h3>
                                    <div className="h-64 w-full" dir="ltr">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <BarChart data={data.trendData}>
                                                <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                                <XAxis dataKey="name" />
                                                <YAxis />
                                                <Tooltip />
                                                <Legend />
                                                <Bar dataKey="bills" name="חקיקה" fill="#3B82F6" radius={[4, 4, 0, 0]} />
                                                <Bar dataKey="votes" name="הצבעות" fill="#34D399" radius={[4, 4, 0, 0]} />
                                            </BarChart>
                                        </ResponsiveContainer>
                                    </div>
                                </div>

                                {/* רשימת פעילות */}
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                                    <h3 className="font-bold mb-4">עדכונים אחרונים</h3>
                                    <div className="space-y-4">
                                        {data.activities.map((act, i) => (
                                            <div key={i} className="flex gap-3 items-start p-3 bg-gray-50 rounded-lg">
                                                <div className="mt-1">
                                                    {act.type === 'bill' ? <span className="text-blue-500"><Icons.Bill/></span> : 
                                                     act.type === 'vote' ? <span className="text-green-500"><Icons.Vote/></span> : 
                                                     <span className="text-purple-500"><Icons.Query/></span>}
                                                </div>
                                                <div>
                                                    <p className="text-sm font-semibold text-gray-800">{act.title}</p>
                                                    <p className="text-xs text-gray-500">{act.date}</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </main>
                    </div>
                );
            };

            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
            
        } catch (err) {
            console.error(err);
            document.getElementById('root').innerHTML = `<div style="padding:20px; color:red">שגיאה קריטית בטעינת האפליקציה: ${err.message}</div>`;
        }
    </script>
</body>
</html>
